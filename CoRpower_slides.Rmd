---
title: "R Package `CoRpower`: Power and Sample Size Calculations for Correlates of Risk"
subtitle: "Based on Gilbert, Janes, Huang (2016, *Stat Med*)"
author: "Michal Juraska"
date: "September 24-26, 2018"
output: 
  ioslides_presentation: 
    widescreen: true
    transition: 0
---

```{r, include=FALSE, cache=TRUE}
library(survival)
library(osDesign)
source("T:/vaccine/StephanieWu/CoR Power Package In Progress/CoRpower/Peter_CoRpower_trinaryMODIFIED.R")

figDir <- "T:/vaccine/StephanieWu/CoR Power Package In Progress/Figures"
```

## Outline
**Power and sample size calculations:**

1. **Without replacement sampling** for retrospective case-control or 2-phase designs
     + Trichotomous biomarker
         + Dichotomous biomarker
     + Continuous biomarker
2. **Bernoulli sampling** for prospective case-cohort designs

<!-- <br> -->
<!-- - All R code illustrated considering P2-VP8 rotavirus vaccine efficacy trial design -->

## Set-up and notation | Without replacement sampling
- Assume a randomized vaccine vs. placebo/control vaccine efficacy trial
- $N=$ number of vaccine recipients observed to be at risk at $\tau$
- $n_{cases}$ ($n_{controls}$) $=$ number of observed cases (controls) between $\tau$ and $\tau_{\mathrm{max}}$, where cases have $\Delta Y = 1$ and controls have $\Delta (1-Y) = 1$
- $n^S_{cases}$ ($n^S_{controls}$) $=$ number of observed cases (controls) between $\tau$ and $\tau_{\mathrm{max}}$ with measured $S$ (or $S^{\ast}$)

<br>
- If calculations done at design stage, then $N$, $n_{cases}$, $n_{controls}$, $n^S_{cases}$, and $n^S_{controls}$ projected numbers

## Algorithm for trichotomous biomarker \(\small\, S\) | Without replacement sampling
<ol>
<li> Specify overall $VE$ between $\tau$ and $\tau_{\mathrm{max}}$
  <ul>
  <li> Protocol-specified design alternative or $\widehat{VE}$
  </ul>
</li>
<li> Specify $risk_0$
  <ul>
  <li> Protocol-specified placebo-group endpoint rate or $\widehat{risk}_0$
  </ul>
</li>
<li> Select a grid of $VE^{lat}_0$ values
  <ul>
  <li> E.g., ranging from $VE$ ($H_0$) to 0 (maximal $H_1$ not allowing harm by vaccination)
  </ul>
</li>
<li> Select a grid of $VE^{lat}_1 \geq VE^{lat}_0$ values
  <ul>
  <li> E.g., $VE^{lat}_1 = VE$
  </ul>
</li>
</ol>

## Algorithm for trichotomous biomarker \(\small\, S\) | Without replacement sampling
<ol start=5>
<li> Specify $P^{lat}_0$ and $P^{lat}_2$, then $P^{lat}_1 = 1-P^{lat}_0-P^{lat}_2$
  <ul>
  <li> Assuming $risk^{lat}_0(x) = risk_0$,
  \[
  VE = VE^{lat}_0 P^{lat}_0 + VE^{lat}_1 P^{lat}_1 + VE^{lat}_2 P^{lat}_2
  \]
  yields $VE^{lat}_2$
  <li> If $VE^{lat}_0$ varies from $VE$ to 0, then $VE^{lat}_2$ varies from VE to $VE\, (P^{lat}_0 + P^{lat}_2)/P^{lat}_2$
  </ul>
</li>
<li> Specify $P_0$ and $P_2$, then $P_1 = 1-P_0-P_2$
  <ul>
  <li> E.g., $P_0 = P^{lat}_0$ and $P_2 = P^{lat}_2$
  </ul>
</li>
</ol>

## Algorithm for trichotomous biomarker \(\small\, S\) | Without replacement sampling
<ol start=7>
<li> **Approach 1:** Specify two of the three $(Sens, FP^0, FP^1)$ and two of the three $(Spec, FN^2, FN^1)$
  <ul>
  <li> E.g., specify $Sens$ and $Spec$ and $FP^0 = FN^2 = 0$
  </ul>

**Approach 2:** Specify $\sigma^2_{obs}$ and $\rho = \sigma^2_{tr} / \sigma^2_{obs}$ and determine $(Sens, Spec, FP^0, FP^1, FN^1, FN^2)$ (subsequent slides)
  <ul>
  <li> Typically, $\sigma^2_{obs} = 1$
  </ul>
</li>
</ol>

## Algorithm for trichotomous biomarker \(\small\, S\) | Without replacement sampling
### **Calculation of $(Sens, Spec, FP^0, FP^1, FN^1, FN^2)$ in Approach 2**
<br>
<ol type="i">
<li> Assuming the classical measurement error model, where $X^{\ast} \sim \mathsf{N}(0,\rho\sigma^2_{obs})$, solve
\[
P^{lat}_0 = P(X^{\ast} \leq \theta_0) \quad \textrm{and} \quad P^{lat}_2 = P(X^{\ast} > \theta_2)
\]
for $\theta_0$ and $\theta_2$
</ol>

## Algorithm for trichotomous biomarker \(\small\, S\) | Without replacement sampling
### **Calculation of $(Sens, Spec, FP^0, FP^1, FN^1, FN^2)$ in Approach 2**
<br>
<ol type="i" start=2>
<li> Generate $M$ realizations of $X^{\ast}$ and $S^{\ast} = X^{\ast} + e$, where $e \sim \mathsf{N}(0,(1-\rho)\sigma^2_{obs})$, and $X^{\ast}$ independent of $e$
  <ul>
  <li> $M = 20000$ by default
  </ul>
</li>
</ol>

## Algorithm for trichotomous biomarker \(\small\, S\) | Without replacement sampling
### **Calculation of $(Sens, Spec, FP^0, FP^1, FN^1, FN^2)$ in Approach 2**
<br>
<ol type="i" start=3>
<li> Using $\theta_0$ and $\theta_2$ from Step i., define
\[
\begin{align}
Spec(\phi_0) &= P(S^{\ast} \leq \phi_0 \mid X^{\ast} \leq \theta_0)\\
FN^1(\phi_0) &= P(S^{\ast} \leq \phi_0 \mid X^{\ast} \in (\theta_0,\theta_2])\\
FN^2(\phi_0) &= P(S^{\ast} \leq \phi_0 \mid X^{\ast} > \theta_2)\\
Sens(\phi_2) &= P(S^{\ast} > \phi_2 \mid X^{\ast} > \theta_2)\\
FP^1(\phi_2) &= P(S^{\ast} > \phi_2 \mid X^{\ast} \in (\theta_0,\theta_2])\\
FP^0(\phi_2) &= P(S^{\ast} > \phi_2 \mid X^{\ast} \leq \theta_0)
\end{align}
\]
</ol>

## Algorithm for trichotomous biomarker \(\small\, S\) | Without replacement sampling
### **Calculation of $(Sens, Spec, FP^0, FP^1, FN^1, FN^2)$ in Approach 2**
<br>
<ol type="i" start=3>
<li> Estimate $Spec(\phi_0)$ by
\[
\widehat{Spec}(\phi_0) = \frac{\#\{S^{\ast}_m \leq \phi_0, X^{\ast}_m \leq \theta_0\}}{\#\{X^{\ast}_m \leq \theta_0\}}\,,
\]
etc.
</ol>

## Algorithm for trichotomous biomarker \(\small\, S\) | Without replacement sampling
### **Calculation of $(Sens, Spec, FP^0, FP^1, FN^1, FN^2)$ in Approach 2**
<br>
<ol type="i" start=4>
<li> Find $\phi_0 = \phi^{\ast}_0$ and $\phi_2 = \phi^{\ast}_2$ that numerically solve
\[
\begin{align}
P_0 &= \widehat{Spec}(\phi_0)P^{lat}_0 + \widehat{FN}^1(\phi_0)P^{lat}_1 + \widehat{FN}^2(\phi_0)P^{lat}_2\\
P_2 &= \widehat{Sens}(\phi_2)P^{lat}_2 + \widehat{FP}^1(\phi_2)P^{lat}_1 + \widehat{FP}^0(\phi_2)P^{lat}_0
\end{align}
\]
and compute
\[
Spec = \widehat{Spec}(\phi^{\ast}_0),\; Sens = \widehat{Sens}(\phi^{\ast}_2),\; \textrm{etc.}
\]
</ol>

## Algorithm for trichotomous biomarker \(\small\, S\) | Without replacement sampling
- In Approach 2, plot
\[
RR_t \quad \textrm{vs.} \quad RR^{lat}_2\big/ RR^{lat}_0,
\]
where
\[
RR_t = \frac{\sum_{x=0}^2 RR^{lat}_x P(X=x|S=2)}{\sum_{x=0}^2 RR^{lat}_x P(X=x|S=0)}
\]
- For $\rho < 1$, $RR_t$ closer to 1 than $RR^{lat}_2\big/ RR^{lat}_0$

## Algorithm for trichotomous biomarker \(\small\, S\) | Without replacement sampling
<ol start=8>
<li> Simulate $B$ data sets under the true parameter values:
  <ol type="a">
  *Full data*
  <li> $N_x = N \times P^{lat}_x$
  <li> $\left(n_{cases}(0),n_{cases}(1),n_{cases}(2)\right) \sim \mathsf{Mult}(n_{cases},(p_0,p_1,p_2))$, where $p_k=P(X=k|Y=1,Y^{\tau}=0,Z=1)$
  <li> For each of the $N_x$ subjects, generate $S_i$ by a draw from $\mathsf{Mult}(1,(p_0,p_1,p_2))$, where $p_k=P(S=k|X=x)$ </li>
  *Observed data*
  <li> Sample without replacement $n^S_{cases}$ and $n^S_{controls} = K n^S_{cases}$ controls with measured $S$ $(R=1)$, i.e., the control:case ratio is not fixed within subgroup $X=x$
  </ol>
</li>
</ol>

## Algorithm for trichotomous biomarker \(\small\, S\) | Without replacement sampling
<ol start=9>
<li> For each observed data set, compute the 1-sided one-degree-of-freedom Wald test statistic for $H_0 \Leftrightarrow \{\widetilde{H}_0: \beta_S \geq 0\}$ from IPW logistic regression model that accounts for biomarker sampling design (function `tps` in R package `osDesign`)
  <ul>
  <li> Alternatively, use the generalized two-degree-of-freedom Wald test
  </ul>
</li>
<li> Compute power as proportion of data sets with 1-sided Wald test $p \leq \alpha/2$ for specified $\alpha$
<li> Repeat power calculation varying control:case ratio, $(P^{lat}_0, P^{lat}_2, P_0, P_2)$, $n_{cases}$, $(Sens, Spec)$, $\rho$
</ol>

# Running the `computepower` function

## CoRpower input scenarios: 
Trichotomous biomarker, Approach 1 ($Sens$, $Spec$, $FP^0$, $FN^2$ specified)
<ul>
  <li>Scenario 1: vary control:case ratio
  <li>Scenario 2: vary $P_0^{lat}$, $P_0$, $P_2^{lat}$, $P_2$
  <li>Scenario 3: vary sensitivity and specificity
  <li>Scenario 4: vary cohort sampling probability, p
</ul>
<br>
Trichotomous biomarker, Approach 2 ($\rho$, $\sigma^2_{obs}$ specified)
<ul>
  <li>Scenario 5: vary $\rho$
  <li>Scenario 6: vary $P_0^{lat}$, $P_0$, $P_2^{lat}$, $P_2$
  <li>Scenario 7: vary $n_{cases}$
</ul>
## CoRpower input scenarios: 
Binary biomarker, Approach 2 ($\rho$, $\sigma^2_{obs}$ specified, $P_0^{lat}+P_2^{lat}=1$)
<ul>
  <li>Scenario 8: vary $n_{cases}$
</ul>
<br>
Continuous biomarker ($\rho$, $\sigma^2_{obs}$, $VE_{lowestvect}$, $P^{lat}_{VElowest}$ specified)
<ul>
  <li>Scenario 9: vary $\rho$
  <li>Scenario 10: vary $P_{lowestVE}^{lat}$
  <li>Scenario 11: vary cohort sampling probability, p
</ul>

## Scenario 1: Trichotomous, approach 1 | Vary control:case ratio {.smaller}
```{r, eval=FALSE}
library(CoRpower)
ans <- computepower(numAtRiskTauCases=31,  # n_cases
                    numAtRiskTauCasesPhase2=31,  # num cases with biomarker measured
                    numAtRiskTauControls=4485,  # n_controls
                    risk0=0.034,  # placebo failure rate 
                    RRoverall=0.25,  # 1-VEoverall
                    Plat0=0.2, P0=0.2,  # low subgroup probabilities for true and observed biomarker
                    Plat2=0.6, P2=0.6,
                    RRlat0=seq(1, 25, len=100),  # rel risks for vaccine vs. placebo in low latent subgroup
                    RRlat1=rep(0.25, 100),  
                    PlatVElowest=0, VElowestvect=NULL,  # set to prevent continuous biomarker scenario
                    ### <b>
                    controlCaseRatio=5*, 
                    ### </b>
                    M=1000,  # number of simulated clinical trials
                    alpha=0.05,  # two-sided type-1 error rate
                    Spec=0.8, Sens=0.8, FP0=0, FN2=0, 
                    biomType="trichotomous")
```

*controlCaseRatio takes on 5, 3, and 1

```{r, echo=FALSE}
setwd("T:/vaccine/StephanieWu/CoR Power Package In Progress/Scenario1/K1")
powerstrinary <- matrix(scan('powerstrinary0.60.25.dat'),nrow=1, byrow=T)
risk1_0 <- matrix(scan('vaccineriskslo0.60.25.dat'), nrow=1, byrow=T)
risk1_2 <- matrix(scan('vaccineriskshi0.60.25.dat'), nrow=1, byrow=T)
RRt <- risk1_2/risk1_0
RRlat2 <- RRlat2 <- scan('RRlat2.dat')
```
## Scenario 1 Output | List of 23 elements: {.smaller}

<br>
<ul>
<li>`powerstrinary`
```{r, echo=FALSE}
powerstrinary[1,1:7]
```
<li>CoR effect size `RRt`
```{r, echo=FALSE}
RRt[1,1:7]
```
<li>`RRlat2` 
```{r, echo=FALSE} 
RRlat2[1:7]
```
<li>`risk1_2`, `risk1_0`, `RRlat0`, `Plat2`, `Plat0`, `P2`, `P0`, `trinaryalpha`, `trinarybeta`, `Sens`, `Spec`, `FP0`, `FN2`, `N`, `nCases`, `nCasesPhase2`, `VEoverall`, `alpha`, `rhos`, `controlCaseRatio`
</ul>

## Scenario 1 Figures
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"powertrinary_CoR_Scen1.png"))
```

## Scenario 2: Trichotomous, approach 1 | Vary \(\small\, P^{lat}_0, P_0, P^{lat}_2, P_2\) {.smaller}
```{r, eval=FALSE}
ans <- computepower(numAtRiskTauCases=31, 
                    numAtRiskTauCasesPhase2=31, 
                    numAtRiskTauControls=4485,
                    risk0=0.034, 
                    RRoverall=0.25, 
                    ### <b>
                    Plat0=0.05*, P0=0.05*,
                    Plat2=0.15*, P2=0.15*, 
                    ### </b>
                    RRlat0=seq(1, 25, len=100), RRlat1=rep(0.25, 100), 
                    PlatVElowest=0, VElowestvect=NULL,  
                    controlCaseRatio=5, 
                    M=1000, 
                    alpha=0.05, 
                    Spec=0.8, Sens=0.8, FP0=0, FN2=0, 
                    biomType="trichotomous")
```

*$P^{lat}_0$ and $P_0$ take on 0.05, 0.1, 0.15, and 0.2, and $P^{lat}_2$ and $P_2$ take on 0.15, 0.3, 0.45, and 0.6

## Scenario 2 Figures
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"powertrinary_CoR_Scen2.png"))
```

## Scenario 3: Trichotomous, approach 1 | Vary \(\small\, Sens \) and \(\small\, Spec\) {.smaller}
```{r, eval=FALSE}
ans <- computepower(numAtRiskTauCases=31, 
                    numAtRiskTauCasesPhase2=31, 
                    numAtRiskTauControls=4485,
                    risk0=0.034, 
                    RRoverall=0.25, 
                    Plat0=0.2, P0=0.2, 
                    Plat2=0.6, P2=0.6, 
                    RRlat0=seq(1, 25, len=100), RRlat1=rep(0.25, 100), 
                    PlatVElowest=0, VElowestvect=NULL,
                    controlCaseRatio=5, 
                    M=1000, 
                    alpha=0.05, 
                    ### <b>
                    Spec=1*, Sens=1*, 
                    ### </b>
                    FP0=0, FN2=0, 
                    biomType="trichotomous")
```

*$Sens$ and $Spec$ take on 1, 0.9, 0.8, and 0.7

## Scenario 3 Figures
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"powertrinary_CoR_Scen3.png"))
```

## Scenario 4: Trichotomous, approach 1 | Vary cohort sampling probability, p {.smaller}
```{r, eval=FALSE}
ans <- computepower(numAtRiskTauCases=31, 
                    numAtRiskTauCasesPhase2=31, 
                    numAtRiskTauControls=4485,
                    risk0=0.034, 
                    RRoverall=0.25, 
                    Plat0=0.2, P0=0.2, 
                    Plat2=0.6, P2=0.6, 
                    RRlat0=seq(1, 25, len=100), RRlat1=rep(0.25, 100), 
                    PlatVElowest=0, VElowestvect=NULL,
                    M=1000, 
                    alpha=0.05, 
                    Spec=1, Sens=1, FP0=0 FN2=0, 
                    biomType="trichotomous", 
                    cohort=TRUE, 
                    ### <b>
                    p=0.01*)
                    ### </b>
                    
```

*$p$ takes on 0.01, 0.02, 0.03, and 0.05

## Scenario 4 Figures
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"powertrinary_CoR_Scen4.png"))
```

## Scenario 5: Trichotomous, approach 2 | Vary \(\small\, \rho \) {.smaller}
```{r, eval=FALSE}
ans <- computepower(numAtRiskTauCases=31, 
                    numAtRiskTauCasesPhase2=31, 
                    numAtRiskTauControls=4485,
                    risk0=0.034, 
                    RRoverall=0.25, 
                    Plat0=0.2, P0=0.2, 
                    Plat2=0.6, P2=0.6, 
                    RRlat0=seq(1, 25, len=100), RRlat1=rep(0.25, 100), 
                    PlatVElowest=0, VElowestvect=NULL,
                    controlCaseRatio=5, 
                    M=1000, 
                    alpha=0.05, 
                    sigma2obs=1,
                    ### <b>
                    rhos=c(1, 0.9, 0.7, 0.5),
                    ### </b>
                    biomType="trichotomous")
```

```{r, echo=FALSE}
setwd("T:/vaccine/StephanieWu/CoR Power Package In Progress/Scenario5")
powerstrinary <- matrix(scan('powerstrinary0.60.25.dat'),nrow=4, byrow=T)
risk1_0 <- matrix(scan('vaccineriskslo0.60.25.dat'), nrow=4, byrow=T)
risk1_2 <- matrix(scan('vaccineriskshi0.60.25.dat'), nrow=4, byrow=T)
RRt <- risk1_2/risk1_0
RRlat2 <- RRlat2 <- scan('RRlat2.dat')
```

## Scenario 5 Output | List of 23 elements: {.smaller}

<div style="float: left; width: 70%;">
<ul>
  <li>`powerstrinary`
```{r, echo=FALSE}
powerstrinary[,1:5]
```
  <li>CoR effect size `RRt`
```{r, echo=FALSE}
RRt[,1:5]
```
  <li>`RRlat2` 
```{r, echo=FALSE} 
RRlat2[1:5]
```
</div>
<div style="float: right; width: 30%;">
<br>
<ul>
  <li> `risk1_2`, `risk1_0`, 
  <br>
  <li> `RRlat0`, `VEoverall`,
  <br>
  <li> `Plat2`, `Plat0`, `P2`, `P0`, 
  <br>
  <li> `trinaryalpha`, `trinarybeta`, 
  <br>
  <li> `Sens`, `Spec`, `FP0`, `FN2`, 
  <br>
  <li> `N`, `nCases`, `nCasesPhase2`, 
  <br>
  <li> `alpha`, `rhos`, `controlCaseRatio`
</ul>

## Scenario 5 Figures
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"powertrinary_CoR_Scen5.png"))
```

## Scenario 5 Table
```{r, echo=FALSE, fig.align='center', out.width='90%'}
knitr::include_graphics(file.path(figDir,"Scen5Table1.png"))
```


## Scenario 6: Trichotomous, approach 2 | Vary \(\small\, P^{lat}_0, P_0, P^{lat}_2, P_2\) {.smaller}
```{r, eval=FALSE}
ans <- computepower(numAtRiskTauCases=31, 
                    numAtRiskTauCasesPhase2=31, 
                    numAtRiskTauControls=4485,
                    risk0=0.034, 
                    RRoverall=0.25, 
                    ### <b>
                    Plat0=0.05*, P0=0.05*, 
                    Plat2=0.15*, P2=0.15*, 
                    ### </b>
                    RRlat0=seq(1, 25, len=100), RRlat1=rep(0.25, 100), 
                    PlatVElowest=0, VElowestvect=NULL,  
                    controlCaseRatio=5, 
                    M=1000, 
                    alpha=0.05, 
                    sigma2obs=1,
                    rhos=0.9,
                    biomType="trichotomous")
```

*$P^{lat}_0$ and $P_0$ take on 0.05, 0.1, 0.15, and 0.2, and $P^{lat}_2$ and $P_2$ take on 0.15, 0.3, 0.45, and 0.6

## Scenario 6 Figures
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"powertrinary_CoR_Scen6.png"))
```

## Scenario 6 Table
```{r, echo=FALSE, fig.align='center', out.width='90%'}
knitr::include_graphics(file.path(figDir,"Scen6Table1.png"))
```


## Scenario 7: Trichotomous, approach 2 | Vary \(\small\, n_{cases}\) {.smaller}
```{r, eval=FALSE}
ans <- computepower(### <b>
                    numAtRiskTauCases=c(25, 31, 35, 40), 
                    numAtRiskTauCasesPhase2=c(25, 31, 35, 40), 
                    numAtRiskTauControls=c(125, 155, 175, 200),
                    ### </b>
                    risk0=0.034, 
                    RRoverall=0.25, 
                    Plat0=0.2, P0=0.2, 
                    Plat2=0.6, P2=0.6, 
                    RRlat0=seq(1, 25, len=100), RRlat1=rep(0.25, 100), 
                    PlatVElowest=0, VElowestvect=NULL,  
                    controlCaseRatio=5, 
                    M=1000, 
                    alpha=0.05, 
                    sigma2obs=1,
                    rhos=0.9,
                    biomType="trichotomous")
```

## Scenario 7 Figures
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"powertrinary_CoR_Scen7.png"))
```

## Scenario 7 Table
```{r, echo=FALSE, fig.align='center', out.width='90%'}
knitr::include_graphics(file.path(figDir,"Scen7Table1.png"))
```


## Scenario 8: Binary, approach 2 | Vary \(\small\, n_{cases}\) {.smaller}
```{r, eval=FALSE}
ans <- computepower(### <b>
                    numAtRiskTauCases=c(25, 31, 35, 40), 
                    numAtRiskTauCasesPhase2=c(25, 31, 35, 40), 
                    numAtRiskTauControls=c(125, 155, 175, 200),
                    ### </b>
                    risk0=0.034, 
                    RRoverall=0.25, 
                    Plat0=0.2, P0=0.2, 
                    Plat2=0.8, P2=0.8, 
                    RRlat0=seq(1, 25, len=100), RRlat1=rep(0.25, 100), 
                    PlatVElowest=0, VElowestvect=NULL,  
                    controlCaseRatio=5, 
                    M=1000, 
                    alpha=0.05, 
                    sigma2obs=1,
                    rhos=0.9,
                    biomType="trichotomous")
```

## Scenario 8 Figures
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"powertrinary_CoR_Scen8.png"))
```

## Scenario 8 Table
```{r, echo=FALSE, fig.align='center', out.width='90%'}
knitr::include_graphics(file.path(figDir,"Scen8Table1.png"))
```

## Scenario 9: Continuous | Vary \(\small\, \rho\) {.smaller}
```{r, eval=FALSE}
ans <- computepower(numAtRiskTauCases=31, 
                    numAtRiskTauCasesPhase2=31, 
                    numAtRiskTauControls=4485,
                    risk0=0.034, 
                    RRoverall=0.25, 
                    PlatVElowest=0.2,  # proportion of vaccinees with lowest value of VE
                    VElowestvect=seq(0, 1-RRoverall, len=100),  # lowest possible value of VE
                    controlCaseRatio=5, 
                    M=1000, 
                    alpha=0.05, 
                    sigma2obs=1,
                    ### <b>
                    rhos=c(1, 0.9, 0.7, 0.5),
                    ### </b>
                    biomType="continuous")
```


```{r, echo=FALSE}
setwd("T:/vaccine/StephanieWu/CoR Power Package In Progress/Scenario9")
powerscont <- matrix(scan('powerscont5.dat'),nrow=4, byrow=T)
RRc <- scan('RRs.dat')
VElowestvect <- scan('VElowestvect.dat')
```

## Scenario 9 Output | List of 13 elements: {.smaller}
<ul>
  <li> `powerstrinary`
```{r, echo=FALSE}
powerstrinary[,1:7]
```
  <li> CoR effect size `RRc`
```{r, echo=FALSE}
RRc[1:5]
```
  <li> `VElowestvect` 
```{r, echo=FALSE} 
VElowestvect[1:5]
```
  <li> `truebetas`, `PlatVElowest`, `N`, `nCases`, `nCasesPhase2`, `VEoverall`, `alpha`, `rhos`, `controlCaseRatio`
</ul>


## Scenario 9 Figures
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"powercontinuous_CoR_Scen9.png"))
```

## Scenario 9 Figures 
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"plotVEcurveCoRcontinuous_Scen9.png"))
```

## Scenario 10: Continuous| Vary \(\small\, P_{lowestVE}^{lat} \) {.smaller}
```{r, eval=FALSE}
ans <- computepower(numAtRiskTauCases=31, 
                    numAtRiskTauCasesPhase2=31, 
                    numAtRiskTauControls=4485,
                    risk0=0.034, 
                    RRoverall=0.25, 
                    ### <b>
                    PlatVElowest=0.05*, 
                    ### </b>
                    VElowestvect=seq(0, 1-RRoverall, len=100),  
                    controlCaseRatio=5, 
                    M=1000, 
                    alpha=0.05, 
                    sigma2obs=1,
                    rhos=0.9,
                    biomType="continuous")
```
*$P_{lowestVE}^{lat}$ takes on 0.05, 0.1, 0.15, and 0.2

## Scenario 10 Figures
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"powercontinuous_CoR_Scen10.png"))
```

## Scenario 10 Figures 
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"plotVEcurveCoRcontinuous_Scen10.png"))
```

## Scenario 11: Continuous | Vary cohort sampling probabiliy, p {.smaller}
```{r, eval=FALSE}
ans <- computepower(numAtRiskTauCases=31, 
                    numAtRiskTauCasesPhase2=31, 
                    numAtRiskTauControls=4485,
                    risk0=0.034, 
                    RRoverall=0.25, 
                    PlatVElowest=0.05, 
                    VElowestvect=seq(0, 1-RRoverall, len=100),  
                    M=1000, 
                    alpha=0.05, 
                    sigma2obs=1,
                    rhos=0.9,
                    biomType="continuous",
                    cohort=TRUE, 
                    ### <b>
                    p=0.01*)
                    ### </b>
```
*$p$ takes on 0.01, 0.02, 0.03, 0.05

## Scenario 11 Figures
```{r, echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics(file.path(figDir,"powercontinuous_CoR_Scen11.png"))
```
